<?php/** * @package     Joomla.Administrator * @subpackage  COM_CWMPRAYER * * @copyright   Copyright (C) 2005 - 2013 Open Source Matters, Inc. All rights reserved. * @license     GNU General Public License version 2 or later; see LICENSE.txt */defined('_JEXEC') or die;class CWMPrayerModelLang extends JModelAdmin{	protected $text_prefix = 'com_cwmprayer';	public function getTable($type = '', $prefix = '', $config = array())	{		return;// JTable::getInstance($type, $prefix, $config);	}	public function getForm($data = array(), $loadData = true)	{		$app = JFactory::getApplication();		$form = $this->loadForm('COM_CWMPRAYER.editlang', 'lang', array('control' => 'jform', 'load_data' => $loadData));		if (empty($form))		{			return false;		}		return $form;	}	protected function loadFormData()	{		$id = $this->getState('id');		$edit = $this->getState('edit');		if (empty($data))		{			$data = $this->getItem();		}		if (!$this->getState('files'))		{			$lffile = 'en-GB.com_cwmprayer.ini';			$lffolder = 'en-GB';		}		else		{			$d = "#[\\\/]#";			$lf = preg_split($d, $this->getState('files'), -1, PREG_SPLIT_NO_EMPTY);			$lffile = $lf[count($lf) - 1];			$lffolder = $lf[count($lf) - 2];		}		if ($edit)		{			$data->config_langfile = $lffile;			$data->config_langfolder = $lffolder;			$filename = JPATH_ROOT . '/language/' . $lffolder . '/' . $lffile;			$initstring = file_get_contents($filename);			$data->config_lang = $initstring;		}		else		{			$data->config_langfile = "";			$data->config_langfolder = "";			$data->config_lang = "";		}		return $data;	}	protected function prepareTable($table)	{	}	protected function getReorderConditions($table)	{	}	public function save($option = 'com_cwmprayer')	{		JSession::checkToken() or jexit('Invalid Token');		$app = JFactory::getApplication();		$foldername = $app->input->get('config_langfolder', null, 'post', 'string');		$filename = $app->input->get('config_langfile', null, 'post', 'string');		$config_lang = $app->input->get('config_lang', null, 'post', 'string');		$configlang = str_replace("[CR][NL]", "\n", $config_lang);		$configlang = str_replace("[ES][SQ]", "'", $configlang);		$configlang = nl2br($configlang);		$configlang = str_replace("<br />", " ", $configlang);		$langfilepath = JPATH_ROOT . '/language/' . $foldername;		if (!is_dir($langfilepath) || !file_exists($langfilepath . '/' . $foldername . '.xml'))		{			$app->enqueueMessage("Please install the corresponding Joomla language extension for " . $foldername . ".COM_CWMPRAYER.ini.", 'message');			return false;		}		$ldata = JApplicationHelper::parseXMLLangMetaFile($langfilepath . '/' . $foldername . '.xml');		if (!is_array($ldata))		{			$app->enqueueMessage("Please install the valid Joomla language extension for " . $foldername . ".COM_CWMPRAYER.ini.", 'message');			return false;		}		$langfilename = $langfilepath . '/' . $foldername . ".COM_CWMPRAYER.ini";		file_put_contents($langfilename, stripslashes($configlang));		$app->enqueueMessage("Changes in the language file have been saved.", 'message');		return true;	}}