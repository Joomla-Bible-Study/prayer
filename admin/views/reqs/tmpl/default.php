<?php/** * prayer Component for Joomla * By Mike Leeper * * @license http://www.gnu.org/copyleft/gpl.html GNU/GPL * */defined('_JEXEC') or die('Restricted access');JHtml::_('bootstrap.tooltip');JHtml::_('behavior.multiselect');JHtml::_('formbehavior.chosen', 'select');$prayeradmin = new CWMPrayerAdmin;$newtopicarray = $prayeradmin->PCgetTopics();$user = JFactory::getUser();$userId = $user->get('id');$listOrder = $this->escape($this->state->get('list.ordering'));$listDirn = $this->escape($this->state->get('list.direction'));$canOrder = $user->authorise('core.edit.state', 'com_cwmprayer.reqs');$saveOrder = $listOrder == 'a.ordering';if ($saveOrder){	$saveOrderingUrl = 'index.php?option=com_cwmprayer&task=requests.saveOrderAjax&tmpl=component';	JHtml::_('sortablelist.sortable', 'pcplansList', 'adminForm', strtolower($listDirn), $saveOrderingUrl);}$sortFields = $this->getSortFields();?>	<form action="<?php echo JRoute::_('index.php?option=com_cwmprayer&view=reqs'); ?>" method="post"	      name="adminForm" id="adminForm">		<?php if (!empty($this->sidebar)) : ?>		<div id="j-sidebar-container" class="span2">			<?php echo $this->sidebar; ?>		</div>		<div id="j-main-container" class="span12">			<?php else : ?>			<div id="j-main-container">				<?php endif; ?>				<div id="filter-bar" class="btn-toolbar">					<div class="filter-search btn-group pull-left">						<label for="filter_search"						       class="element-invisible"><?php echo JText::_('COM_CWMPRAYER_FILTER_SEARCH_DESC'); ?></label>						<input type="text" name="filter_search" id="filter_search"						       placeholder="<?php echo JText::_('COM_CWMPRAYER_SEARCH'); ?>"						       value="<?php echo $this->escape($this->state->get('filter.search')); ?>"						       title="<?php echo JText::_('COM_LIVINGWORD_SEARCH'); ?>"/>					</div>					<div class="btn-group pull-left">						<button class="btn hasTooltip" type="submit"						        title="<?php echo JText::_('JSEARCH_FILTER_SUBMIT'); ?>"><i class="icon-search"></i>						</button>						<button class="btn hasTooltip" type="button"						        title="<?php echo JText::_('JSEARCH_FILTER_CLEAR'); ?>"						        onclick="document.id('filter_search').value='';this.form.submit();"><i									class="icon-remove"></i></button>					</div>					<div class="btn-group pull-right hidden-phone">						<label for="limit"						       class="element-invisible"><?php echo JText::_('JFIELD_PLG_SEARCH_SEARCHLIMIT_DESC'); ?></label>						<?php echo $this->pagination->getLimitBox(); ?>					</div>					<div class="btn-group pull-right hidden-phone">						<label for="directionTable"						       class="element-invisible"><?php echo JText::_('JFIELD_ORDERING_DESC'); ?></label>						<select name="directionTable" id="directionTable" class="input-medium"						        onchange="Joomla.orderTable()">							<option value=""><?php echo JText::_('JFIELD_ORDERING_DESC'); ?></option>							<option value="asc" <?php if ($listDirn == 'asc') echo 'selected="selected"'; ?>><?php echo JText::_('JGLOBAL_ORDER_ASCENDING'); ?></option>							<option value="desc" <?php if ($listDirn == 'desc') echo 'selected="selected"'; ?>><?php echo JText::_('JGLOBAL_ORDER_DESCENDING'); ?></option>						</select>					</div>					<div class="btn-group pull-right">						<label for="sortTable"						       class="element-invisible"><?php echo JText::_('JGLOBAL_SORT_BY'); ?></label>						<select name="sortTable" id="sortTable" class="input-medium" onchange="Joomla.orderTable()">							<option value=""><?php echo JText::_('JGLOBAL_SORT_BY'); ?></option>							<?php echo JHtml::_('select.options', $sortFields, 'value', 'text', $listOrder); ?>						</select>					</div>				</div>				<div class="clearfix"></div>				<table class="table table-striped" id="pcplansList">					<thead>					<tr>						<th width="1%" class="nowrap center hidden-phone">							<?php echo JHtml::_('grid.sort', '<i class="icon-menu-2"></i>',								'a.ordering', $listDirn, $listOrder, 'reqs', 'asc', 'JGRID_HEADING_ORDERING'); ?>						</th>						<th width="1%" class="hidden-phone">							<input type="checkbox" name="checkall-toggle" value=""							       title="<?php echo JText::_('JGLOBAL_CHECK_ALL'); ?>"							       onclick="Joomla.checkAll(this)"/>						</th>						<th width="5%" class="hidden-phone nowrap">							<?php echo JHTML::_('grid.sort', 'JSTATUS', 'a.publishstate', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_REQUESTER', 'a.requester', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_EMAIL_ADDRESS', 'a.email', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_TOPIC', 'a.topic', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'JGLOBAL_TITLE', 'a.title', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_REQUEST', 'a.request', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_DATE_TIME', 'a.datetime', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th class="hidden-phone">							<?php echo JHTML::_('grid.sort', 'COM_CWMPRAYER_DISPLAY', 'a.displaystate', $listDirn, $listOrder, 'reqs'); ?>						</th>						<th width="5%" class="hidden-phone nowrap">							<?php echo JHTML::_('grid.sort', 'JGRID_HEADING_ID', 'a.id', $listDirn, $listOrder, 'reqs'); ?>						</th>					</tr>					</thead>					<tfoot>					<tr>						<td colspan="10">							<?php echo $this->pagination->getListFooter(); ?>						</td>					</tr>					</tfoot>					<tbody>					<?php					foreach ($this->items as $i => $item)					{					$item->max_ordering = 0;						$ordering   = ($listOrder == 'a.ordering');						$canEdit    = $user->authorise('core.edit',       'com_content.article.' . $item->id);						$canCheckin = $user->authorise('core.manage',     'com_checkin') || $item->checked_out == $userId || $item->checked_out == 0;						$canChange  = $user->authorise('core.edit.state', 'com_content.article.' . $item->id) && $canCheckin;						$request = $item->request;						$request = strip_tags($request, "<i><strong><u><em><strike>");						$request = stripslashes($request);						if (strlen($request) > 50)						{							$request = substr($request, 0, 48) . " ...";						}						$ordering = ($listOrder == 'a.ordering');						$canCheckin = $user->authorise('core.manage', 'com_checkin') || $item->checked_out == $user->get('id') || $item->checked_out == 0;						$canChange = true;						?>						<td class="order nowrap center hidden-phone">							<?php							$iconClass = '';							if (!$canChange)							{								$iconClass = ' inactive';							}							elseif (!$saveOrder)							{								$iconClass = ' inactive tip-top hasTooltip" title="' . JHtml::_('tooltipText', 'JORDERINGDISABLED');							}							?>							<span class="sortable-handler<?php echo $iconClass ?>">								<span class="icon-menu"></span>							</span>							<?php if ($canChange && $saveOrder) : ?>								<input type="text" style="display:none" name="order[]" size="5" value="<?php echo $item->ordering; ?>" class="width-20 text-area-order " />							<?php endif; ?>						</td>						<td class="center">							<?php echo JHtml::_('grid.id', $i, $item->id); ?>						</td>							<td class="center">								<div class="btn-group">									<?php echo JHtml::_('jgrid.published', $item->publishstate, $i, 'reqs.', $canChange, 'cb'); ?>									<?php // Create dropdown items and render the dropdown list.									if ($canChange)									{										JHtml::_('actionsdropdown.' . ((int) $item->publishstate === 2 ? 'un' : '') . 'archive', 'cb' . $i, 'reqs');										JHtml::_('actionsdropdown.' . ((int) $item->publishstate === -2 ? 'un' : '') . 'trash', 'cb' . $i, 'reqs');										echo JHtml::_('actionsdropdown.render', $this->escape($item->title));									}									?>								</div>							</td>							<td class="small hidden-phone"><?php echo $item->requester; ?></td>							<td class="small hidden-phone"><?php echo $item->email; ?></td>							<td class="small hidden-phone"><?php echo $newtopicarray[$item->topic + 1]['text']; ?></td>							<td class="has-context">								<div class="pull-left break-word">									<?php if ($item->checked_out) : ?>										<?php echo JHtml::_('jgrid.checkedout', $i, $item->editor, $item->checked_out_time, 'articles.', $canCheckin); ?>									<?php endif; ?>									<?php if ($canEdit) : ?>										<a class="hasTooltip" href="<?php echo JRoute::_('index.php?option=com_cwmprayer&task=req.edit&id=' . $item->id); ?>" title="<?php echo JText::_('JACTION_EDIT'); ?>">											<?php echo $this->escape($item->title); ?></a>									<?php else : ?>									<span title="<?php echo $this->escape($item->title); ?></span>									<?php endif; ?>								</div>							</td>							<td class="small hidden-phone">								<?php echo $this->escape(JText::_($request)); ?>								<?php if ($item->checked_out) : ?><br/>									<?php echo JHtml::_('jgrid.checkedout', $i, $item->editor, $item->checked_out_time, '', $canCheckin); ?>								<?php endif; ?>							</td>							<td class="small hidden-phone"><?php echo $item->datetime; ?></td>							<?php							$displayimg = [];							$displayimg[] = '<a class="btn btn-micro active" rel="tooltip"';							if ($item->displaystate)							{								$displayimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.hidereq\')"';								$displayimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Hide Request'))) . '">';								$displayimg[] = '<i class="icon-publish">';							}							else							{								$displayimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.displayreq\')"';								$displayimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Display Request'))) . '">';								$displayimg[] = '<i class="icon-unpublish">';							}							$displayimg[] = '</i>';							$displayimg[] = '</a>';							$publishimg = [];							$publishimg[] = '<a class="btn btn-micro active" rel="tooltip"';							if ($item->publishstate)							{								$publishimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.unpublish\')"';								$publishimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Unpublish Request'))) . '">';								$publishimg[] = '<i class="icon-publish">';							}							else							{								$publishimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.publish\')"';								$publishimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Publish Request'))) . '">';								$publishimg[] = '<i class="icon-unpublish">';							}							$publishimg[] = '</i>';							$publishimg[] = '</a>';							$archiveimg   = [];							$archiveimg[] = '<a class="btn btn-micro active" rel="tooltip"';							if ($item->archivestate)							{								$archiveimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.unarchive\')"';								$archiveimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Unarchive Request'))) . '">';								$archiveimg[] = '<i class="icon-publish">';							}							else							{								$archiveimg[] = ' href="javascript:void(0);" onclick="return listItemTask(\'cb' . $i . '\', \'req.archive\')"';								$archiveimg[] = ' title="' . addslashes(htmlspecialchars(JText::_('Archive Request'))) . '">';								$archiveimg[] = '<i class="icon-unpublish">';							}							$archiveimg[] = '</i>';							$archiveimg[] = '</a>';							?>							<td class="small hidden-phone"><?php echo implode($displayimg); ?></td>							<td class="center hidden-phone">								<?php echo (int) $item->id; ?>							</td>						</tr>						<?php					}					?>					</tbody>				</table>				<input type="hidden" name="task" value=""/>				<input type="hidden" name="boxchecked" value="0"/>				<input type="hidden" name="filter_order" value="<?php echo $listOrder; ?>"/>				<input type="hidden" name="filter_order_Dir" value="<?php echo $listDirn; ?>"/>				<?php echo JHTML::_('form.token'); ?>			</div>		</div>		</div></form><?phpecho $prayeradmin->PrayerFooter();